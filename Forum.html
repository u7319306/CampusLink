<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Student Forum - CampusLink</title>
  <meta name="description" content="Ask questions, share tips, and connect with peers at ANU">
  <link rel="stylesheet" href="pages.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <section class="mb-8">
      <div class="flex justify-between items-center gap-4" style="flex-wrap: wrap;">
        <div>
          <h1>Student Forum</h1>
          <p class="text-lg text-muted">Ask questions, share tips, and connect with peers.</p>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-primary" onclick="openPostComposer()" id="new-post-btn"></button>
          <button class="btn btn-outline" onclick="openCreateGroup()" id="new-group-btn"></button>
        </div>
      </div>
    </section>

    <!-- Main Layout -->
    <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;">
      <!-- Mobile: Groups dropdown, Desktop: Left sidebar -->
      <div id="groups-section" style="display: none;">
        <div class="groups-rail card">
          <div class="card-content">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold">Groups</h2>
              <button class="btn btn-sm btn-ghost" onclick="openGroupBrowser()">Browse</button>
            </div>
            <div id="groups-list"></div>
          </div>
        </div>
      </div>

      <!-- Center: Thread list -->
      <div>
        <div class="mb-4 flex gap-3" style="flex-wrap: wrap;">
          <div style="flex: 1; position: relative; min-width: 200px;">
            <div id="search-icon-forum" style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></div>
            <input type="text" id="search-input" class="input" placeholder="Search posts..." style="padding-left: 2.5rem;" onkeyup="filterPosts()">
          </div>
          <div class="tabs-list">
            <button class="tab active" onclick="setSort('hot')">Hot</button>
            <button class="tab" onclick="setSort('new')">New</button>
            <button class="tab" onclick="setSort('top')">Top</button>
          </div>
        </div>
        
        <div id="posts-container"></div>
      </div>

      <!-- Right rail (desktop only) - will be populated by JS -->
      <div id="right-rail" style="display: none;"></div>
    </div>
  </div>

  <!-- Post Composer Modal -->
  <div id="composer-modal" class="modal-overlay hidden" onclick="closeModalsOnBackdrop(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>Create a Post</h2>
      </div>
      <div class="modal-body">
        <div class="mb-4">
          <label for="post-title" class="text-sm font-semibold mb-2" style="display: block;">Title</label>
          <input type="text" id="post-title" class="input" placeholder="What's your question or topic?">
        </div>
        <div class="mb-4">
          <label for="post-group" class="text-sm font-semibold mb-2" style="display: block;">Group</label>
          <select id="post-group" class="select"></select>
        </div>
        <div class="mb-4">
          <label for="post-body" class="text-sm font-semibold mb-2" style="display: block;">Body</label>
          <div class="flex gap-2 mb-2">
            <button class="btn btn-sm btn-ghost" onclick="formatText('**', '**')"><strong>B</strong></button>
            <button class="btn btn-sm btn-ghost" onclick="formatText('*', '*')"><em>I</em></button>
            <button class="btn btn-sm btn-ghost" onclick="formatText('`', '`')"><code>Code</code></button>
          </div>
          <textarea id="post-body" class="textarea" placeholder="Share your thoughts... (supports **bold**, *italic*, `code`)" style="min-height: 200px;"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closePostComposer()">Cancel</button>
        <button class="btn btn-primary" onclick="submitPost()">Post</button>
      </div>
    </div>
  </div>

  <!-- Create Group Modal -->
  <div id="group-modal" class="modal-overlay hidden" onclick="closeModalsOnBackdrop(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>Create a New Group</h2>
        <p class="text-muted text-sm">Start a community around a topic that matters to you</p>
      </div>
      <div class="modal-body">
        <label for="group-name" class="text-sm font-semibold mb-2" style="display: block;">Group Name</label>
        <input type="text" id="group-name" class="input" placeholder="e.g., Physics Study Group">
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeCreateGroup()">Cancel</button>
        <button class="btn btn-primary" onclick="submitGroup()">Create Group</button>
      </div>
    </div>
  </div>

  <!-- Group Browser Modal -->
  <div id="browser-modal" class="modal-overlay hidden" onclick="closeModalsOnBackdrop(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>All Groups</h2>
      </div>
      <div class="modal-body">
        <div style="position: relative; margin-bottom: 1rem;">
          <div id="browser-search-icon" style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></div>
          <input type="text" id="group-search" class="input" placeholder="Search groups..." style="padding-left: 2.5rem;" onkeyup="filterGroupBrowser()">
        </div>
        <div id="browser-groups" style="max-height: 400px; overflow-y: auto;"></div>
      </div>
    </div>
  </div>

  <!-- Post View Drawer -->
  <div id="post-drawer" class="drawer-overlay hidden" onclick="closePostView(event)">
    <div class="drawer" onclick="event.stopPropagation()">
      <button class="btn btn-ghost btn-icon" onclick="closePostView()" style="position: absolute; top: 1rem; right: 1rem;" id="close-drawer-btn"></button>
      <div id="drawer-content"></div>
    </div>
  </div>

  <script src="shared.js"></script>
  <script src="forum.js"></script>
</body>
</html>